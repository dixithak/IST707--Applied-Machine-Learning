---
title: "Assignment 2"
author: "Dixitha Kasturi"
date: "2/8/2022"
output: pdf_document
  keep_md: yes
---


_Loading Data:_ 

```{r}
setwd('C:/Users/kastu/Desktop/Syracuse/Spring22/IST707-AML/Week2/Assignment')
library(tidyverse)
market <- read_csv('supermarket_sales.csv')

```
```{r}
dim(market)
```

The supermarket dataset has 1000 records of purchases with 18 different attributes for each purchase. We will be exploring some of these attributes in detail to understand and get insights from the data that could be further used to understand any underlying conditions or situations that are resulting in the numbers that are reflected.


_Exploratory Data Analysis:_ 

Overall it is a clean dataset with not a lot of transformations to do.

```{r}
str(market)

```

* We don't necessarily see the need to transform any attribute. Customer type, Gender, Product line, Payment, Branch are all character type, but we don't need to convert them into factors despite them having repetitive values, is because factors in R are nothing but ordinal data. And we don't need order/hierarchy for any of the above mentioned attributes. So i am not performing any transformation.


```{r}
summary(market)

```

```{r}
library(Hmisc)
describe(market)

```


* Describe gives us complete picture of the attributes from the missing values, disntinct values , descriptive statistics and quantile values.

* There are no missing values in any of the attributes

* Almost equal number of orders from males and females, Members and normal customers

* From the descriptive statistics especially for the numeric attributes, we see that the values are the same for Tax and Grossincome. An interesting observation is that the lowest rating was 4 on a scale of 1-10. For time( from 10am to 9pm) since the values are continuous, by discretizing it we can give a broader picture of our analysis related to time.



```{r}
#Outliers: 
jpeg(filename="Boxplot_totalbrancg.jpeg")
boxplot(Total ~ Branch, data = market)
dev.off()

jpeg(filename="Boxplot_ratingbranch.jpeg")
boxplot(Rating ~ Branch, data = market)
dev.off()

jpeg(filename="Boxplot_quantitybranch.jpeg")
boxplot(Quantity ~ Branch, data = market)
dev.off()

```


* Just a few outliers in the total cost from branch A and B. These values dont need to be excluded from the dataset as they are less in number and they can be justified as high purchases.


```{r}
#Cleaning column names for easy use

colnames(market) <- c('InvoiceID','Branch','City','Customertype','Gender',
                      'Productline','Unitprice','Quantity','Tax','Total',
                      'Date','Time','Payment','cogs','grossmarginpercentage',
                      'grossincome','Rating')


# Discretizing time levels
market$time_levels <- cut(strptime(market$Time, format = "%H:%M:%S"), 
                          breaks = strptime(c( "10:00:00","12:00:00","16:00:00",
                                               "19:00:00","21:00:00")
                                            , format = "%H:%M:%S"), 
   labels = c("Morning", "Afternoon","Evening","Night"))


# Getting data by branches

branchA <- market[which(market$Branch == 'A'),]
branchB <- market[which(market$Branch == 'B'),]
branchC <- market[which(market$Branch == 'C'),]

```


_Analysis :_

```{r}
library(dplyr)
library(ggplot2)

```



* Grossincome by customertype and branch - All three branches had similar gross income generated by customers who were members and normal type

```{r}

# Grouping data by branch and customer type
tab1 <- market %>% group_by(Branch,Customertype) %>% summarise(count = n(),
                                                               grossincome = sum(grossincome),Quantity = sum(Quantity), Tax = sum(Tax))
jpeg(filename ="grossincome_customerbranch.jpeg")
                                                               
ggplot(data = tab1,aes(x= Branch, y=count, fill=Customertype)) +
  geom_bar(stat="identity", position=position_dodge()) +
  ggtitle("Grossincome by customer type and branch")+
  geom_text(aes(label = grossincome), position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 4, hjust = 1, angle=  90)
dev.off()

```



* Gross income and tax summed upto the same, which was first observed in descriptive statistics.

```{r}
grossincome_B <- market %>% group_by(Branch) %>% summarise(grossincome = sum(grossincome),Quantity = sum(Quantity), Tax = sum(Tax))
grossincome_B

```




_Payment methods used by branch:_ 

* At Branch A, Ewallet high Ewallet payments were made, while at Branch B all 3 payment methods were equally used. On the contrary Branch C had high cash payments, this does in a way indicate that change should be checked often.

```{r}

# Grouping data by payment method and branch with plot

jpeg(filename ="paymentbranch.jpeg")
ggplot(market %>% group_by(Payment, Branch) %>% summarise(counts = n()),
       aes(x= Branch, y= counts,fill = Payment)) +
  geom_bar(stat="identity",position=position_dodge()) +
  ggtitle("Payment methods by Branch")
dev.off()

```



_By Branch findings:_


```{r}

# Grouping branch and product categories and plotting the data

BP <-  market %>% group_by(Branch, Productline) %>% summarise(
  counts = n(),Total = sum(Total))

jpeg(filename = "productlines_branch.jpeg")
ggplot(data= BP,aes(y= Productline, x= Total,fill = Branch)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Product lines by Branch") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Total), position = position_dodge(width = 0.9),
            vjust = 0.8,size = 3, hjust = 1)
dev.off()

# Branch A

jpeg(filename = "BranchAproductlines.jpeg")
ggplot(data= branchA %>% group_by(Productline) %>% summarise(counts = n(),
                                                             Total = sum(Total))
       , aes(x =Total,y=Productline, fill = Productline)) +
  geom_bar(stat="identity",position=position_dodge()) +
  ggtitle("Branch A")+
  theme(axis.text.x =  element_text(angle = 90), legend.position = "none")+
  geom_text(aes(label = Total), position = position_dodge(width = 0.9),
            vjust = 0.8,size = 5, hjust = 1)
dev.off()

#Branch B
jpeg(filename = "BranchBproductlines.jpeg")
ggplot(data= branchB %>% group_by(Productline) %>% summarise(
  counts = n(), Total = sum(Total))
       , aes(y=Productline, x =Total, fill = Productline)) +
  geom_bar(stat="identity",position=position_dodge()) +
  ggtitle("Branch B")+
  theme(axis.text.x =  element_text(angle = 90), legend.position = "none")+
  geom_text(aes(label = Total), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 5, hjust = 1)
dev.off()

#Branch C
jpeg(filename = "BranchCproductlines.jpeg")
ggplot(data= branchC %>% group_by(Productline) %>% summarise(
  counts = n(), Total = sum(Total))
       , aes(y=Productline, x = Total, fill = Productline)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Branch C")+
  theme(axis.text.x =  element_text(angle = 90), legend.position = "none")+
  geom_text(aes(label = Total), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 5, hjust = 1)
dev.off()


```

* Branch A generated high total amounts in home and lifestyle($22417.19)

* Branch B generated high total amounts in Sports and travel($19988.19). 
  Health and beauty( $19980.66)

* Branch C generated high total amounts in Food and Beverages( $23766.85) 
  Fashion accessories ($21560.07)
  Electronic accessories($18968.97)  





_By Gender findings:_

```{r}

#Grouping data by Branch and Gender
genderdata <- market %>% group_by(Branch, Gender) %>% summarise(
  Quantity = sum(Quantity), count = n(), grossincome = sum(grossincome))

jpeg(filename = "Grossincome_genderbranch.jpeg")
ggplot(data = genderdata,aes(x= Branch, y= Quantity,fill = Gender)) +
  geom_bar(stat="identity",position=position_dodge()) +
  ggtitle("Grossincome by Gender and Branch") +
  geom_text(aes(label = grossincome), position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 3, hjust = 1, angle  = 90)
dev.off()

# Payment methods


jpeg(filename = "genderpayment.jpeg")
ggplot(market %>% group_by(Gender,Payment) %>% summarise(counts = n()),
       aes(x= Gender, y= counts,fill = Payment)) + 
  ggtitle("Payment by gender")+
  geom_bar(stat="identity",position=position_dodge())
dev.off()

# Productlines 
jpeg(filename ="productline_gender.jpeg")
ggplot(market %>% group_by(Gender,Productline) %>% summarise(
  Total = sum(Total),count = n()),
  aes(x= Productline, y= Total,fill = Gender)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Productlines by Gender") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Total), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 2.5, hjust = 1, angle  = 90)
dev.off()

# Branch A

jpeg(filename = "productline_genderA.jpeg")
ggplot(branchA %>% group_by(Gender,Productline) %>% summarise(
  Total = sum(Total),count = n()),
  aes(x= Productline, y= Total,fill = Gender)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Productlines by Gender for Branch A") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Total), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 3, hjust = 1, angle  = 90)
dev.off()

#Branch B
jpeg(filename = "productline_genderB.jpeg")
ggplot(branchB %>% group_by(Gender,Productline) %>% summarise(
  Total = sum(Total),count = n()),
  aes(x= Productline, y= Total,fill = Gender)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Productlines by Gender for Branch B") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Total), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 3, hjust = 1, angle  = 90)

dev.off()

#Branch C
jpeg(filename = "productline_genderC.jpeg")
ggplot(branchC %>% group_by(Gender,Productline) %>% summarise(
  Total = sum(Total),count = n()),
  aes(x= Productline, y= Total,fill = Gender)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Productlines by Gender for Branch C") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Total), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 3, hjust = 1, angle  = 90)

dev.off()

```

* Branch A : Males generated high Gross income($2520.53). Females purchased more  electronic accessories, fashion accessories,home and lifestyle products while males purchased more in  Food and Beverages, sports and travel and surprisingly health and beauty

* Branch B : Males and Females generated equal gross income. Females purchased more Food and Beverages, fashion accessories,home and lifestyle products while males purchased more in  electronic accessories, sports and travel and surprisingly very high in health and beauty

* Branch C : Females generated high gross income($2937.4). Females purchased more Food and Beverages, fashion accessories,home and lifestyle, sports and travel products while males purchased more in  electronic accessories, and surprisingly very high in health and beauty


* Females mostly preferred Cash payments while males preferred Ewallet

* Overall females purchased more products from Food and Beverages, fashion accessories,home and lifestyle, sports and travel products

* Overall males purchased more in health and beauty and a little more in electronic goods

_Productlines by Customertype:_

```{r}

PC <-  market %>% group_by(Customertype, Productline) %>% summarise(
  counts = n(),Total = sum(Total))
PC

jpeg(filename = "productlines_customertype.jpeg")
ggplot(data= PC,aes(y= Productline, x= Total,fill = Customertype)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Product lines by CustomerType") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Total), 
            position = position_dodge(width = 0.9), 
            vjust = 0.9,size = 3, hjust = 1)
dev.off()

```


* Overall, customers who are existing members in contributed more to Sports and travel, home and lifestyle, health and beauty, food and beverages

* Normal customers, who were not members, had high sales in Fashion accessories and electronic accessories.


_Timeperiod of Sales_

```{r}

Time_B<- market %>% group_by(Branch,time_levels) %>% summarise(
  counts = n(), grossincome = sum(grossincome), Total = sum(Total))
Time_B

jpeg(filename = "sales.jpeg")
ggplot(data= Time_B, aes(x=time_levels, y=Total, group=Branch)) +
  geom_line(aes(linetype=Branch, color = Branch))+
  geom_point(aes(color = Branch)) + 
  ggtitle("Sales by timeframe")
dev.off()

```

* Discretized Timings of orders into 4 groups : 10 am to 12pm as morning, 12pm to 4pm as afternoon, 4pm to 7pm as evening and 7pm to 9pm as night 

* In all 3 branches, the total sales and gross income were high during afternoon period and sales gradually increased from 9am to 12pm
* For Branch A : Sales continuously dipped after 4pm
* For Branch B : Sales dipped from 4pm to 7pm but increased after 7pm
* For Branch C : Sales decreased after 4pm but it was not a steep drop.



_Rating analysis:_

by store, by category,by gender, by customertype

```{r}

rb<- market %>% group_by(Branch) %>% summarise(counts = n(), 
                                               Averagerating = mean(Rating))
rb

rc <- market %>% group_by(Customertype) %>% summarise(
  counts = n(), Averagerating = mean(Rating))
rc

rg <- market %>% group_by(Gender) %>% summarise(
  counts = n(), Averagerating = mean(Rating))
rg

rbg <- market %>% group_by(Branch,Gender) %>% summarise(
  counts = n(), Averagerating = round(mean(Rating),3))
rbg


rgc <- market %>% group_by(Gender,Productline) %>% summarise(
  counts = n(), Averagerating = round(mean(Rating),3))
rgc

jpeg(filename ="rating_branchgender.jpeg")
ggplot(data = rbg,aes(x= Branch, y= Averagerating,fill = Gender)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Rating by Branch and gender") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Averagerating), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 3, hjust = 1, angle  = 90)
dev.off()

jpeg(filename ="rating_productcustomer.jpeg")
ggplot(data = rgc,aes(x= Productline, y= Averagerating,fill = Gender)) +
  geom_bar(stat="identity",position=position_dodge())+
  ggtitle("Rating by Products and Customer type") +
  theme(axis.text.x =  element_text(angle = 90))+
  geom_text(aes(label = Averagerating), 
            position = position_dodge(width = 0.9), 
            vjust = 0.8,size = 3, hjust = 1, angle  = 90)

dev.off()

```

* The average rating given for all 3 branches were more or less the same but branch C had the highest at 7.07

* Customers who were members surprisingly had low average rating at 6.94 compared to normal customers with average of 7

* Male and Female customers had more or less equal average rating overall but for individual branches, Males had high average rating for branch A while females had high average rating for branch B,C

* Females gave higher rating for  health and beauty,fashion and accessories, food and beverages and  categories where as males gave higher ratings in electronic accessories, home and lifestyle, sports and travel




NOTE : A lot of indepth analysis related to exact time of purchases wrt customer type, product category, ratings by categories in each branch etc can be explored heavily further.
